<!-- 参考サイト : https://www.sukimalog.com/archives/36190861-three-gltf-load.html -->
<!DOCTYPE html>
<html lang="ja">
  <head>
    <title>gtlf load</title>
    <style>
      body {
        /*ページ全体を使用するためmarginを0に設定
            overflowをhiddenに設定*/
        margin: 0;
        overflow: hidden;
      }
    </style>
  </head>
  <body>
    <!-- (表示) 出力を保持する -->
    <div id="WebGL-output"></div>
    <!-- Three.jsコードの記述 -->
    <script type="module">
      // CDNからThree.js読み込み
      import * as THREE from'https://unpkg.com/three@0.126.1/build/three.module.js';
      import { OrbitControls } from 'https://unpkg.com/three@0.126.1/examples/jsm/controls/OrbitControls.js';
      import { GLTFLoader } from 'https://unpkg.com/three@0.126.1/examples/jsm/loaders/GLTFLoader.js';
      var camera;       // カメラ
      var scene;        // シーン
      var renderer;     // レンダラー
      var controls;     // カメラコントロール
      /* すべての読み込みが終わってからThree.js関連の処理を実行 */
      function init() {
        // オブジェクト、カメラ、ライトなどすべての要素を格納するシーン作成 
        scene = new THREE.Scene();
        scene.fog = new THREE.FogExp2(0xffffff, 0.005); // 遠くの物が霞んで見える設定
        // カメラ作成
        camera = new THREE.PerspectiveCamera(
          45,                                     // 視野
          window.innerWidth / window.innerHeight, // アスペクト比
          0.1,                                    // どの程度のカメラの距離から描画を始めるか
          1000                                    // どのくらい遠くまで見えるか
        );
        scene.add(camera);                        // カメラをシーンに追加
        camera.position.x = -30;
        camera.position.y = 40;
        camera.position.z = 30;
        camera.lookAt(scene.position);            // シーンの中心にカメラを向ける
        // レンダラー作成
        renderer = new THREE.WebGLRenderer();
        renderer.setClearColor(new THREE.Color(0xeeeeee));
        renderer.setPixelRatio(window.devicePixelRatio);    // 解像度変更
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.shadowMap.enabled = true;        // オブジェクトシャドウを有効化
        
        // 均等光源(影なし)
        var ambientLight = new THREE.AmbientLight(0x0c0c0c, 1);
        scene.add(ambientLight);
        // 点座標への光源(影あり)
        var spotLight = new THREE.SpotLight(0xffffff, 1);
        spotLight.position.set(-20, 30, -5);
        spotLight.castShadow = true; // 影を落とす
        scene.add(spotLight);
        // 無限遠からの平行光源
        var directionalLight = new THREE.DirectionalLight(0xffffff, 0.5);
        directionalLight.position.set(20, -30, 5).normalize(); // 光源方向設定
        scene.add(directionalLight);
        /* glbファイルの読み込み */
        const loader = new GLTFLoader();
        loader.load ('./AliciaSolid.vrm', function(gltf){
          gltf.scene.scale.set(6, 6, 6);                      // モデルスケール変更
          gltf.scene.position.set(0, 0, 0);                   // モデル位置変更
          gltf.scene.rotation.set(0, (0 * Math.PI /180), 0);  // モデル向き変更
          scene.add(gltf.scene);                              // モデルをシーンに追加
        }, undefined, function (error) {
          console.error(error);
        }); 
        // レンダラーの出力をhtmlの(WebGL-output)に追加
        document
          .getElementById("WebGL-output")
          .appendChild(renderer.domElement);
        // OrbitControlsを初期化し、カメラとレンダラーを渡す
        controls = new OrbitControls(camera, renderer.domElement);
        controls.enableRotate = true; // カメラの回転を有効化
        // シーンを描画
        render();
      }
      // シーンを描画する関数
      function render() {
          requestAnimationFrame(render);  // レンダリング(再帰)
          renderer.render(scene, camera); // 表示
      }
      
      // 表示領域をウィンドウサイズに合わせる
      function onResize() {
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth, window.innerHeight);
      }
      // 表示が終わってからThree.js関連処理(関数init)を実行
      window.addEventListener("load", init);
      // リサイズイベント
      window.addEventListener("resize", onResize, false);
    </script>
  </body>
</html>