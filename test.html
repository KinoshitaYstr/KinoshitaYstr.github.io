<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    
    <!-- 必要なライブラリ読み込み -->
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/pose/pose.js"></script>

</head>
<body>
    
    <div class="main">
        <!-- カメラ入力(非表示) -->
        <video id="inputVideo" style="display: none;"></video>
        <canvas id="output" width="600" height="400"></canvas>
    </div>

    <script>
        const video = document.getElementById('inputVideo');
        // 写真の上にランドマークを描写用
        const canvas = document.getElementById('output');
        const ctx = canvas.getContext('2d');

        // 関連ファイルの読み込み
        const config = {
            locateFile: file => `https://cdn.jsdelivr.net/npm/@mediapipe/pose/${file}`
        };
        const pose = new Pose(config);

        const camera = new Camera(video, {
            onFrame: async () => {
                await pose.send({image: video});
            },
            width: 600,
            height: 400
        });

        pose.setOptions({
            modelComplexity: 1,
            smoothLandmarks: true,
            enableSegmentation: true,
            smoothSegmentation: true,
            minDetectionConfidence: 0.5,
            minTrackingConfidence: 0.5
        });

        pose.onResults(results => {
            ctx.clearRect(0, 0, 600, 400);
            ctx.drawImage(results.image, 0, 0, 600, 400);

            if (results.poseLandmarks) {
                drawConnectors(ctx, results.poseLandmarks, POSE_CONNECTIONS, {color: '#00FF00', lineWidth: 4});
                drawLandmarks(ctx, results.poseLandmarks, {color: '#FF0000', lineWidth: 2});
            }
        });

        camera.start();
    </script>
</body>
</html>